<!doctype html>
<title>Creation</title>
<link rel="stylesheet" type="text/css" href="css/iframe.css">
<link rel="stylesheet" type="text/css" href="css/creation.css">
<!-- JQUERY UI STARTS -->
<link type="text/css" href="../lib/jqueryui/css/ui-lightness/jquery-ui-1.8.20.custom.css" rel="Stylesheet" />
<script src="../lib/jqueryui/js/jquery-1.7.2.min.js" charset="utf-8"></script>
<script src="../lib/jqueryui/js/jquery-ui-1.8.20.custom.min.js" charset="utf-8"></script>
<!-- JQUERY UI ENDS -->

<!--  CF -->
<script src="./../CF/ChernoffFacesSimple.js" charset="utf-8"></script>
<script src="./../CF/CFControls.js" charset="utf-8"></script>
<!-- CF ends -->


<body>
	<h2>Create your personal drawing</h2>
<p>
  Move the sliders below to compose an original portrait. Feel free to express
	yourself in the style that you feel more confortable with. You can produce 
	both realistic or abstract paintings.  
</p>
<p>
	Once you have finished your creation, click on one of the three exhibition 
	names (A, B, or C) to submit your work, and proceed to the next step.
</p>
<div id="container">
	   <div id="creation"></div>
		      <dl id="submission">
           <dt><button id="ex_A" onclick="javascript:parent.node.emit('DONE', 'A');"/>A</button></dt>
           <dt><button id="ex_B" onclick="javascript:parent.node.emit('DONE', 'B');"/>B</button></dt>
           <dt><button id="ex_C" onclick="javascript:parent.node.emit('DONE', 'C');"/>C</button></dt>
         </dl>
	 </div>    
	   <div id="history"></div>
	</div>
</body>
<script>
	
	  var node = parent.node;
	
    var creationDiv = document.getElementById('creation');
    node.game.personal_history = node.window.addWidget('NDDBBrowser', creationDiv, {id: 'ph'});
      
    
    var CFControls = node.window.widgets.CFControls;
    var defaults = CFControls.defaults;
    //console.dir(defaults);

     
      var sc_options = {
        id: 'cf_controls',
        features: defaults,
        change: 'CF_CHANGE',
        submit: 'Send'
      };
    
      var cfc = new CFControls(sc_options);
    
      //node.emit('INPUT_ENABLE');
      
      var cf_options = { id: 'cf',
                 width: 500,
                 height: 500,
                 features: this.last_cf,
                 controls: cfc,
//								 controls: false,
      };
      
     node.game.cf = node.window.addWidget('ChernoffFacesSimple', creationDiv, cf_options);
    
      node.game.personal_history.add(node.game.cf.getAllValues());
      
      // History of previous exhibits
      //var historyDiv = node.window.getElementById('history');
      var historyDiv = document.getElementById('history');


      node.game.all_ex.parse();
      //node.window.write(node.game.all_ex.getRoot(), historyDiv);
      //$(node.game.all_ex.getRoot()).append(historyDiv);
      historyDiv.appendChild(node.game.all_ex.getRoot());
			
      // Adding to history
      node.on(node.game.cf.change, function() {
        node.game.personal_history.add(node.game.cf.getAllValues());
      });
      
      // Pulling back from history
      node.on(node.game.personal_history.id + '_GOT', function (face) {
        node.game.cf.draw(face);
      });
			
      $( "history canvas").hover(
         function(){
          $(this).css({
            border: '3px solid #CCC'
          });
         },
         function(){
          $(this).css({
            border: 0
          });
         });

//      $( "canvas").click(
//         function () {
//           var id = '#' + $(this).attr('id');
//           
//          var canvas = document.getElementById($(this).attr('id'));
//          
////          canvas.width = 200;
////          canvas.height = 200;
//          
//          var div = $('<div>', {
//            
//          }
//          );
//          var copy = $('<canvas width="300" height"300">');
//          copy.css({
//            border: '1px solid #CCC',
//            background: 'white',
//          });
//          var copy = copy[0];
//          copy.width = 300;
//          copy.height = 300;
//          var destCtx = copy.getContext('2d');
//          
//          // translate context to center of canvas
//          destCtx.translate(canvas.width / 2, canvas.height / 2); 
//          // scale down y component by half
//          destCtx.scale(2, 2);
//          //call its drawImage() function passing it the source canvas directly
//          destCtx.drawImage(canvas, 0, 0);
//
//          
//          div.append(copy);
//          
//          div.dialog({
//            width: 400,
//            height: 400,
//            show: "blind",
//            hide: "explode",
//            buttons: {
//              "Copy": function() {
//                $( this ).dialog( "close" );
//              },
//              Cancel: function() {
//                $( this ).dialog( "close" );
//              }
//          }
//          });
//  });     
        

			

</script>