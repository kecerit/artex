<!doctype html>
<title>Creation</title>
<link rel="stylesheet" type="text/css" href="css/iframe.css">
<link rel="stylesheet" type="text/css" href="css/creation.css">
<!-- JQUERY UI STARTS -->
<link type="text/css" href="../lib/jqueryui/css/ui-lightness/jquery-ui-1.8.20.custom.css" rel="Stylesheet" />
<script src="../lib/jqueryui/js/jquery-1.7.2.min.js" charset="utf-8"></script>
<script src="../lib/jqueryui/js/jquery-ui-1.8.20.custom.min.js" charset="utf-8"></script>
<!-- JQUERY UI ENDS -->

<!--  CF -->
<script src="./../CF/ChernoffFacesSimple.js" charset="utf-8"></script>
<script src="./../CF/CFControls.js" charset="utf-8"></script>
<!-- CF ends -->


<body>
	<h2>Create your personal drawing</h2>
	
	<div id="creation"></div>
             
	 
	 <div id="container">
		 <div id="history"></div>
		 
		 <div id="done_box">
		 	<button>Click here when you are done</button>
		 </div>
	</div>

	<div id="submission" style="visibility: hidden;">
    <dl id="sub_list">
      <span id="text_sub_list">Select the exhibition you would like to submit your drawing to:</span>
     <dt><button id="ex_A" onclick="javascript:parent.node.emit('DONE', 'A');"/>A</button></dt>
     <dt><button id="ex_B" onclick="javascript:parent.node.emit('DONE', 'B');"/>B</button></dt>
     <dt><button id="ex_C" onclick="javascript:parent.node.emit('DONE', 'C');"/>C</button></dt>
   </dl>
 </div>
 
</body>
<script>
	
	  var node = parent.node;
	
    var creationDiv = document.getElementById('creation');
    var ph = node.game.personal_history = node.window.getWidget('NDDBBrowser', {id: 'ph'});
      
    
    //var CFControls = node.window.widgets.CFControls;
    var defaults = CFControls.defaults;
    //console.dir(defaults);

     
      var sc_options = {
        id: 'cf_controls',
        features: defaults,
        change: 'CF_CHANGE',
        submit: 'Send'
      };
    
      var cfc = new CFControls(sc_options);
    
      //node.emit('INPUT_ENABLE');
      
      var cf_options = { id: 'cf',
                 width: 500,
                 height: 500,
                 features: this.last_cf,
                 controls: cfc,
//								 controls: false,
      };
      
     node.game.cf = node.window.addWidget('ChernoffFacesSimple', creationDiv, cf_options);
     $('#cf_controls').before(ph.commandsDiv);
		 
     node.game.personal_history.add(node.game.cf.getAllValues());
      
      // History of previous exhibits
      //var historyDiv = node.window.getElementById('history');
      var historyDiv = document.getElementById('history');


      node.game.all_ex.parse();
      //node.window.write(node.game.all_ex.getRoot(), historyDiv);
      //$(node.game.all_ex.getRoot()).append(historyDiv);
      historyDiv.appendChild(node.game.all_ex.getRoot());
			
      // Adding to history
      node.on(node.game.cf.change, function() {
        node.game.personal_history.add(node.game.cf.getAllValues());
      });
      
      // Pulling back from history
      node.on(node.game.personal_history.id + '_GOT', function (face) {
        node.game.cf.draw(face);
      });
			
      $( "history canvas").hover(
         function(){
          $(this).css({
            border: '3px solid #CCC'
          });
         },
         function(){
          $(this).css({
            border: 0
          });
         });
			
      $('#done_box button').click(function(){
    	  $(function() {
    		    // a workaround for a flaw in the demo system (http://dev.jqueryui.com/ticket/4375), ignore!
    		    //$( "#dialog:ui-dialog" ).dialog( "destroy" );
    		  
    		    $( "#submission #sub_list" ).dialog({
    		      resizable: false,
    		      width: 550,
    		      height: 300,
    		      modal: true,
    		    });
    		  });
      });
      

</script>