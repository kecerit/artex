<!doctype html>
<title>Evaluation</title>
<!-- JQUERY UI STARTS -->
<link type="text/css" href="lib/jqueryui/css/ui-lightness/jquery-ui-1.8.20.custom.css" rel="Stylesheet" />
<script src="lib/jqueryui/js/jquery-1.7.2.min.js" charset="utf-8"></script>
<script src="lib/jqueryui/js/jquery-ui-1.8.20.custom.min.js" charset="utf-8"></script>
<!-- JQUERY UI ENDS -->

<!-- To avoid: "attempt to run compile-and-go script on a cleared scope" -->
<script src="CF/ChernoffFacesSimple.js" charset="utf-8"></script>

<link rel="stylesheet" type="text/css" href="css/iframe.css">
<link rel="stylesheet" type="text/css" href="css/evaluation.css">

<body>
  <h2>Evaluation</h2>
  Express a quality judgement on the paintings just made by other players. Move the slider on a scale from 0 to 10,  where
  <ul>
    <li> 0 (zero) means <em>complete dislike</em> </li>
    <li> 5 (five) means that you are <em>indifferent</em> </li>
    <li> 10 (ten) means <em>complete like</em> </li>
  </ul>
  <p>
    The same paintings will be reviewed also by other players, and each painting that
    will receive an average evaluation greater than <strong>5.00 (five)</strong>
    will be put on display.
  </p>
  <div id="container_evaluation"></div>
  <div id="container_done">
    <div id="done_box" >
      <button onclick='javascript:parent.node.done();'>Click here when you are done</button>
    </div>
  </div>

</body>

<script type="text/javascript">
    <!--

  window.onload = function(){

      var node = parent.node,
      JSUS = parent.JSUS,
      W = parent.W,
      Table = W.Table;

      // Avoid ESC to break the connection
      W.noEscape(window);

      var table = new Table({
          auto_update: true,
          id: 'tbl_evaluation',
      });

      var headers = [];

      node.on.data('CF', function(msg) {
          var cf_options, cf;
          var display, display_container, sl;
          var labelText;

          console.log('RECEIVED CF ********************');

          cf_options = {
              width: 300,
              height: 300,
              scaleX: 1,
              scaleY: 1,
              features: msg.data.face,
              id: false,
              change: false,
              controls: false
          };
          cf = node.widgets.get('ChernoffFaces', cf_options);

          var evaId = 'eva_' + msg.data.from;
          var diplayEvaId = 'display_' + msg.data.from;
          var displayContId = 'display_cont_' + msg.data.from;

          // Add the slider to the container

// Slider.
//          , {
//              'style': 'border: 0; background: white; width:300px'
//          }

          sl = W.getDiv(evaId);
          display_container = W.getDiv(displayContId);
          display = W.addTextInput(display_container, diplayEvaId, {
              disabled: "disabled",
              className: 'curr-eva-input'
          });

          labelText = 'Your current evaluation: ';
          W.addLabel(display_container, display, null, labelText);

          this.evas[msg.data.from] = display;

          headers.push('Review for Exhibition: ' + msg.data.ex);
          table.setHeader(headers);
          table.addColumn([sl, display_container, cf.getCanvas()]);

          // Add jquery slider.
          $( "#" + evaId).slider({
              value: 5,
              min: 0,
              max: 10,
              step: 0.1,
              slide: function( event, ui ) {
                  $( "#" + diplayEvaId ).val( ui.value );
                  node.game.evasChanged[msg.data.from] = true;
              }
          });
          $( "#" + diplayEvaId ).val( $( "#" + evaId ).slider( "value" ) );

          table.parse();

          // AUTOPLAY.
          node.env('auto', function(){
              node.timer.randomExec(function() {
                  $( "#" + evaId ).slider( "value",  Math.random()*10);
                  $( "#" + diplayEvaId ).val( $( "#" + evaId ).slider( "value" ) );
              }, 4000);
          });

      });

      document.getElementById('container_evaluation').appendChild(table.table);
      node.env('auto', function(){
          node.timer.randomExec(function() {
              node.done();
          }, 10000);
      });
  }

  //-->
</script>
